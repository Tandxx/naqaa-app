<!-- views/settings.ejs - Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù†Ù‚Ø§Ø¡</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Noto Sans Arabic', 'Space Grotesk', sans-serif; 
    }
    
    /* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn, button, input, select, textarea {
      pointer-events: auto !important;
      z-index: 100 !important;
      position: relative !important;
      cursor: pointer !important;
    }
    
    .btn:disabled {
      cursor: not-allowed !important;
      opacity: 0.6;
    }
    
    .btn:not(:disabled):hover {
      transform: translateY(-2px);
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„ */
    .card, .form-group, .nav-links {
      pointer-events: auto !important;
    }
    
    /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù€ checkboxes */
    input[type="checkbox"] {
      pointer-events: auto !important;
      z-index: 150 !important;
      cursor: pointer !important;
      transform: scale(1.5);
      accent-color: var(--primary);
    }
    
    /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù€ selects */
    select {
      cursor: pointer !important;
      background-color: var(--bg-input) !important;
      color: var(--text-primary) !important;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    form {
      pointer-events: auto !important;
      z-index: 10 !important;
    }
    
    /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
    .notification {
      pointer-events: auto !important;
      z-index: 10000 !important;
    }
    
    /* Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
    a {
      pointer-events: auto !important;
      z-index: 100 !important;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <nav class="navbar" id="navbar">
      <div class="container">
        <a href="/dashboard" class="logo">
          <img src="../image/1.png" alt="Ù†Ù‚Ø§Ø¡" class="logo-img">
          <span>Ù†Ù‚Ø§Ø¡</span>
        </a>
        <ul class="nav-links">
          <li><a href="/dashboard">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li><a href="/log">ØªØ³Ø¬ÙŠÙ„ ÙŠÙˆÙ…ÙŠ</a></li>
          <li><a href="/resources">Ø§Ù„Ù…ØµØ§Ø¯Ø±</a></li>
          <li><a href="/settings" style="color: var(--primary-light);">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a></li>
          <li>
            <form action="/logout" method="POST" style="display: inline;">
              <button type="submit" class="btn btn-secondary">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </form>
          </li>
        </ul>
      </div>
    </nav>

    <main class="container section">
      <div class="fade-in">
        <h1 style="margin-bottom: var(--space-lg); text-align: center;">
          <span style="font-size: 2rem; margin-left: var(--space-sm);">âš™ï¸</span>
          Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </h1>
      </div>

      <!-- Settings Form -->
      <form id="settingsForm" action="/settings/update" method="POST">
        <div class="grid grid-2">
          <!-- Theme Settings -->
          <div class="card slide-up" style="transition-delay: 0.1s;">
            <div class="card-header">
              <h3 class="card-title">
                <span style="margin-left: var(--space-xs);">ğŸ¨</span>
                Ø§Ù„Ø³Ù…Ø©
              </h3>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©</label>
              <select name="theme" class="form-control">
                <option value="dark" <%= (user.settings && user.settings.theme === 'dark') || !user.settings ? 'selected' : '' %>>
                  ğŸŒ™ Ø¯Ø§ÙƒÙ†Ø©
                </option>
                <option value="light" <%= user.settings && user.settings.theme === 'light' ? 'selected' : '' %>>
                  â˜€ï¸ ÙØ§ØªØ­Ø©
                </option>
              </select>
            </div>
          </div>

          <!-- Language Settings -->
          <div class="card slide-up" style="transition-delay: 0.2s;">
            <div class="card-header">
              <h3 class="card-title">
                <span style="margin-left: var(--space-xs);">ğŸŒ</span>
                Ø§Ù„Ù„ØºØ©
              </h3>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙØ¶Ù„Ø©</label>
              <select name="language" class="form-control">
                <option value="ar" <%= (user.settings && user.settings.language === 'ar') || !user.settings ? 'selected' : '' %>>
                  ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                </option>
                <option value="en" <%= user.settings && user.settings.language === 'en' ? 'selected' : '' %>>
                  ğŸ‡ºğŸ‡¸ English
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Disguise Mode -->
        <div class="card slide-up" style="transition-delay: 0.3s;">
          <div class="card-header">
            <h3 class="card-title">
              <span style="margin-left: var(--space-xs);">ğŸ”’</span>
              ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ‡
            </h3>
          </div>
          <div style="background: var(--bg-glass); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-md);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
              <span style="font-size: 1.5rem;">ğŸ›¡ï¸</span>
              <strong style="color: var(--text-secondary);">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ‡ØŸ</strong>
            </div>
            <p style="color: var(--text-tertiary); line-height: 1.6; margin: 0;">
              Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙˆØ¶Ø¹ØŒ Ø³ØªØ¸Ù‡Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙƒÙ…ÙˆÙ‚Ø¹ Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ù†Ø¸ÙŠÙØ©. Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ø§Ø¶ØºØ· Ù…Ø¹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø²Ø± "Generate Report" Ù„Ù…Ø¯Ø© 3 Ø«ÙˆØ§Ù†.
            </p>
          </div>
          <div style="display: flex; align-items: center; justify-content: space-between; gap: var(--space-md);">
            <div>
              <label class="form-label" style="margin-bottom: var(--space-xs); font-weight: 600;">ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ‡</label>
              <p style="color: var(--text-muted); font-size: 0.9rem; margin: 0;">Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø®ØµÙˆØµÙŠØ©</p>
            </div>
            <input 
              type="checkbox" 
              name="disguiseMode" 
              id="disguiseMode"
              <%= user.settings && user.settings.disguiseMode ? 'checked' : '' %>
            >
          </div>
        </div>

        <!-- Confirm Settings Button -->
        <div class="card slide-up" style="transition-delay: 0.4s; text-align: center;">
          <div id="unsavedChanges" style="display: none; margin-bottom: var(--space-md);">
            <div style="background: rgba(255, 184, 0, 0.1); border: 1px solid var(--warning); color: var(--warning); padding: var(--space-md); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; gap: var(--space-sm);">
              <span>âš ï¸</span>
              <span>Ù„Ø¯ÙŠÙƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©</span>
            </div>
          </div>
          <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap;">
            <button 
              type="submit" 
              id="confirmBtn"
              class="btn btn-secondary" 
              style="padding: var(--space-md) var(--space-2xl); font-size: 1.1rem;"
              disabled
            >
              <span>âœ…</span>
              <span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </button>
            <button 
              type="button" 
              id="resetBtn"
              class="btn btn-secondary" 
              style="padding: var(--space-md) var(--space-2xl); font-size: 1.1rem;"
              disabled
            >
              <span>ğŸ”„</span>
              <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
            </button>
          </div>
        </div>
      </form>

      <!-- Account Management -->
      <div class="card slide-up" style="transition-delay: 0.5s;">
        <div class="card-header">
          <h3 class="card-title" style="color: var(--danger);">
            <span style="margin-left: var(--space-xs);">ğŸ‘¤</span>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
          </h3>
        </div>
        
        <div style="background: rgba(255, 71, 87, 0.1); border: 1px solid var(--border-danger); border-radius: var(--radius-md); padding: var(--space-lg); margin-bottom: var(--space-lg);">
          <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md);">
            <span style="font-size: 1.5rem;">âš ï¸</span>
            <h4 style="color: var(--danger); margin: 0;">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
          </div>
          <p style="color: var(--text-tertiary); margin-bottom: var(--space-md); line-height: 1.6;">
            Ø³ÙŠØ¤Ø¯ÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¥Ù„Ù‰ Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.
          </p>
          
          <form action="/settings/delete-account" method="POST" onsubmit="return confirmDelete()">
            <div class="form-group">
              <label class="form-label">Ø§ÙƒØªØ¨ "DELETE" Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù:</label>
              <input 
                type="text" 
                name="confirmDelete" 
                class="form-control" 
                placeholder="DELETE"
                style="border-color: var(--border-danger);"
                required
              >
            </div>
            <button type="submit" class="btn btn-danger">
              <span>ğŸ—‘ï¸</span>
              <span>Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Account Statistics -->
      <div class="card slide-up" style="transition-delay: 0.6s;">
        <div class="card-header">
          <h3 class="card-title">
            <span style="margin-left: var(--space-xs);">ğŸ“Š</span>
            Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
          </h3>
        </div>
        <div class="grid grid-2" style="gap: var(--space-md);">
          <div style="background: var(--bg-glass); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: var(--space-md);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
              <span style="font-size: 1.5rem;">ğŸ‘¤</span>
              <strong style="color: var(--text-secondary);">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong>
            </div>
            <span style="color: var(--text-tertiary); font-size: 1.1rem;"><%= user.username %></span>
          </div>
          
          <div style="background: var(--bg-glass); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: var(--space-md);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
              <span style="font-size: 1.5rem;">ğŸ“…</span>
              <strong style="color: var(--text-secondary);">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</strong>
            </div>
            <span style="color: var(--text-tertiary); font-size: 1.1rem;">
              <%= new Date(user.createdAt).toLocaleDateString('ar-SA') %>
            </span>
          </div>
          
          <div style="background: var(--bg-glass); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: var(--space-md);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
              <span style="font-size: 1.5rem;">ğŸ”¥</span>
              <strong style="color: var(--text-secondary);">Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</strong>
            </div>
            <span style="background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; font-size: 1.1rem;">
              <%= user.streak %> ÙŠÙˆÙ…
            </span>
          </div>
          
          <div style="background: var(--bg-glass); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: var(--space-md);">
            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
              <span style="font-size: 1.5rem;">ğŸ¨</span>
              <strong style="color: var(--text-secondary);">Ø§Ù„Ø³Ù…Ø© Ø§Ù„Ù†Ø´Ø·Ø©</strong>
            </div>
            <span style="color: var(--text-tertiary); font-size: 1.1rem;">
              <%= (user.settings && user.settings.theme === 'light') ? 'â˜€ï¸ ÙØ§ØªØ­Ø©' : 'ğŸŒ™ Ø¯Ø§ÙƒÙ†Ø©' %>
            </span>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    let hasUnsavedChanges = false;
    const originalValues = {
      theme: '<%= (user.settings && user.settings.theme) || "dark" %>',
      language: '<%= (user.settings && user.settings.language) || "ar" %>',
      disguiseMode: <%= (user.settings && user.settings.disguiseMode) || false %>
    };

    function markAsChanged() {
      const form = document.getElementById('settingsForm');
      
      const currentValues = {
        theme: form.querySelector('select[name="theme"]').value,
        language: form.querySelector('select[name="language"]').value,
        disguiseMode: form.querySelector('input[name="disguiseMode"]').checked
      };

      hasUnsavedChanges = (
        currentValues.theme !== originalValues.theme ||
        currentValues.language !== originalValues.language ||
        currentValues.disguiseMode !== originalValues.disguiseMode
      );

      updateUI();
    }

    function updateUI() {
      const confirmBtn = document.getElementById('confirmBtn');
      const resetBtn = document.getElementById('resetBtn');
      const unsavedMsg = document.getElementById('unsavedChanges');

      if (hasUnsavedChanges) {
        confirmBtn.disabled = false;
        resetBtn.disabled = false;
        unsavedMsg.style.display = 'block';
        confirmBtn.classList.remove('btn-secondary');
        confirmBtn.classList.add('btn-primary');
        confirmBtn.style.cursor = 'pointer';
        resetBtn.style.cursor = 'pointer';
      } else {
        confirmBtn.disabled = true;
        resetBtn.disabled = true;
        unsavedMsg.style.display = 'none';
        confirmBtn.classList.remove('btn-primary');
        confirmBtn.classList.add('btn-secondary');
        confirmBtn.style.cursor = 'not-allowed';
        resetBtn.style.cursor = 'not-allowed';
      }
    }

    function resetForm() {
      const form = document.getElementById('settingsForm');
      
      form.querySelector('select[name="theme"]').value = originalValues.theme;
      form.querySelector('select[name="language"]').value = originalValues.language;
      form.querySelector('input[name="disguiseMode"]').checked = originalValues.disguiseMode;
      
      hasUnsavedChanges = false;
      updateUI();
    }

    function confirmDelete() {
      return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.');
    }

    // Show notifications
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.style.cssText = `
        position: fixed !important;
        top: 20px !important;
        right: 20px !important;
        background: var(--card-bg) !important;
        border: 1px solid var(--border-primary) !important;
        padding: 1rem !important;
        border-radius: var(--radius-md) !important;
        box-shadow: var(--shadow-lg) !important;
        z-index: 10000 !important;
        max-width: 400px !important;
        opacity: 0 !important;
        transform: translateX(100%) !important;
        transition: all 0.3s ease !important;
        pointer-events: auto !important;
      `;
      
      notification.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
          <span style="color: var(--text-primary);">${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: var(--text-muted); font-size: 1.25rem; cursor: pointer; pointer-events: auto !important; z-index: 10001 !important;">Ã—</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.remove();
            }
          }, 300);
        }
      }, 5000);
    }

    // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    function enhanceInteractivity() {
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      const buttons = document.querySelectorAll('button, .btn');
      buttons.forEach(btn => {
        btn.style.pointerEvents = 'auto';
        btn.style.zIndex = '100';
        btn.style.position = 'relative';
        btn.style.cursor = btn.disabled ? 'not-allowed' : 'pointer';
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± hover
        if (!btn.disabled) {
          btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
          });
          
          btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
          });
        }
      });

      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ù€ inputs
      const inputs = document.querySelectorAll('input, select, textarea');
      inputs.forEach(input => {
        input.style.pointerEvents = 'auto';
        input.style.zIndex = '100';
        input.style.position = 'relative';
        input.style.cursor = 'pointer';
      });

      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
      const links = document.querySelectorAll('a');
      links.forEach(link => {
        link.style.pointerEvents = 'auto';
        link.style.zIndex = '100';
        link.style.position = 'relative';
      });
    }

    // Handle URL params for notifications
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ”§ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
      
      // ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„
      enhanceInteractivity();
      
      const urlParams = new URLSearchParams(window.location.search);
      
      if (urlParams.get('success')) {
        const messages = {
          'theme_updated': 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­',
          'disguise_updated': 'ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ¶Ø¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ‡ Ø¨Ù†Ø¬Ø§Ø­',
          'language_updated': 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ØºØ© Ø¨Ù†Ø¬Ø§Ø­',
          'settings_updated': 'ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…'
        };
        const message = messages[urlParams.get('success')] || 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­';
        showNotification(message, 'success');
        window.history.replaceState({}, document.title, '/settings');
      }
      
      if (urlParams.get('error')) {
        const messages = {
          'update_failed': 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«',
          'invalid_theme': 'Ø³Ù…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©',
          'invalid_language': 'Ù„ØºØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø©',
          'delete_failed': 'ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨'
        };
        const message = messages[urlParams.get('error')] || 'Ø­Ø¯Ø« Ø®Ø·Ø£';
        showNotification(message, 'danger');
        window.history.replaceState({}, document.title, '/settings');
      }

      // Initialize UI
      updateUI();
      
      // Add event listeners
      const form = document.getElementById('settingsForm');
      const themeSelect = form.querySelector('select[name="theme"]');
      const languageSelect = form.querySelector('select[name="language"]');
      const disguiseCheckbox = form.querySelector('input[name="disguiseMode"]');
      
      console.log('ğŸ›ï¸ Ø¥Ø¶Ø§ÙØ© Event Listeners...');
      
      themeSelect.addEventListener('change', function() {
        console.log('Theme changed to:', this.value);
        markAsChanged();
      });
      
      languageSelect.addEventListener('change', function() {
        console.log('Language changed to:', this.value);
        markAsChanged();
      });
      
      disguiseCheckbox.addEventListener('change', function() {
        console.log('Disguise mode changed to:', this.checked);
        markAsChanged();
      });
      
      const resetBtn = document.getElementById('resetBtn');
      resetBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Reset button clicked');
        resetForm();
      });

      // Scroll animations
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, observerOptions);

      document.querySelectorAll('.fade-in, .slide-up').forEach(el => {
        observer.observe(el);
      });

      // Navbar scroll effect
      const navbar = document.getElementById('navbar');
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      });
      
      console.log('âœ… ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
    });

    // Warn user about unsaved changes when leaving page
    window.addEventListener('beforeunload', function(e) {
      if (hasUnsavedChanges) {
        e.preventDefault();
        e.returnValue = 'Ù„Ø¯ÙŠÙƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ØŸ';
        return e.returnValue;
      }
    });
  </script>
</body>
</html>